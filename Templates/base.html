<!DOCTYPE html>
<html lang="es" class="h-full">
<head>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ title or "BerriBrew 路 Fresa & Mora" }}</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: {
              50:"#ecfdf5",100:"#d1fae5",200:"#a7f3d0",300:"#6ee7b7",
              400:"#34d399",500:"#10b981",600:"#059669",700:"#047857",
              800:"#065f46",900:"#064e3b"
            }
          },
          boxShadow: { soft:"0 8px 24px rgba(0,0,0,.08)" }
        }
      },
      darkMode: 'class'
    }
  </script>

  <link rel="stylesheet" href="https://unpkg.com/@tabler/icons-webfont@latest/tabler-icons.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <style>
    .glass {
      background: rgba(255,255,255,.75);
      backdrop-filter: saturate(180%) blur(8px);
    }
    .dark .glass {
      background: rgba(17,24,39,.65);
    }
  </style>

  <script>
    (function(){
      const s = localStorage.getItem('theme');
      if(s==='dark' || (!s && matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
      }
    })();
  </script>
</head>

<body class="h-full bg-gradient-to-br from-brand-50 via-teal-50 to-cyan-50 dark:from-slate-900 dark:via-slate-900 dark:to-slate-900 text-slate-800 dark:text-slate-100">
  <div class="min-h-screen flex">
    <!-- Sidebar -->
    <aside class="hidden md:flex w-64 flex-col border-r border-pink-200/40 dark:border-slate-800 bg-gradient-to-b from-pink-100/70 via-white/60 to-fuchsia-100/60 dark:from-slate-900/70 dark:via-slate-800/60 dark:to-slate-900/70 backdrop-blur-xl shadow-lg">

      <div class="px-4 py-4 flex items-center gap-3">
        <i class="ti ti-beer text-2xl text-brand-600"></i>
        <div>
          <div class="font-extrabold leading-tight text-pink-400 text-lg">BerriBrew</div>
          <div class="text-xs text-slate-500 dark:text-slate-400">Fresa &amp; Mora 路 Panel</div>
        </div>
      </div>

      <nav class="mt-2 px-2 text-sm">
        <a href="{{ url_for('index') }}" class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-brand-50 dark:hover:bg-slate-800 {% if request.endpoint=='index' %}bg-brand-50 dark:bg-slate-800{% endif %}">
          <i class="ti ti-home"></i> Inicio
        </a>
        <a href="{{ url_for('producto') }}" class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-brand-50 dark:hover:bg-slate-800 {% if request.endpoint=='producto' %}bg-brand-50 dark:bg-slate-800{% endif %}">
          <i class="ti ti-beer"></i> Producto
        </a>
        {% if current_user.is_authenticated %}
          <a href="{{ url_for('entendimiento') }}" class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-brand-50 dark:hover:bg-slate-800 {% if request.endpoint=='entendimiento' %}bg-brand-50 dark:bg-slate-800{% endif %}">
            <i class="ti ti-chart-histogram"></i> Entendimiento
          </a>
          <a href="{{ url_for('batches_list') }}" class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-brand-50 dark:hover:bg-slate-800 {% if request.endpoint=='batches_list' %}bg-brand-50 dark:bg-slate-800{% endif %}">
            <i class="ti ti-barrel"></i> Lotes
          </a>
        {% endif %}
      </nav>

      <div class="mt-auto p-4 text-xs text-slate-500 dark:text-slate-400">
        &copy; {{ 2025 }} Fresa &amp; Mora 路 0.0%
      </div>
    </aside>

    <!-- Main column -->
    <div class="flex-1 flex flex-col">

      <!-- Header mejorado -->
      <header class="glass border-b border-white/60 dark:border-white/10 sticky top-0 z-10">
        <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between gap-3">
          <!-- Logos y nombre -->
          <div class="flex items-center gap-3">
            <img src="{{ url_for('static', filename='img/logo_udec.png') }}"
                 alt="Logo Universidad de Cundinamarca"
                 class="h-12 w-12 object-contain rounded-full bg-white p-1 shadow-md border border-white/30">
            <img src="{{ url_for('static', filename='img/logo_loja.png') }}"
                 alt="Logo Universidad de Loja"
                 class="h-12 w-12 object-contain rounded-full bg-white p-1 shadow-md border border-white/30">
            <span class="text-2xl font-extrabold tracking-wide ml-2 text-pink-300">
              BerriBrew
            </span>
          </div>

          <!-- Botones y tema -->
          <div class="flex items-center gap-2">
            <button id="themeToggle" class="inline-flex items-center justify-center w-9 h-9 rounded-lg hover:bg-white/60 dark:hover:bg-slate-800" title="Tema">
              <i class="ti ti-moon-stars dark:hidden"></i>
              <i class="ti ti-sun hidden dark:inline"></i>
            </button>

            {% if current_user.is_authenticated %}
              <span class="hidden sm:inline text-sm text-slate-600 dark:text-slate-300">Hola, {{ current_user.name }}</span>
              <form action="{{ url_for('logout') }}" method="post">
                <button class="px-3 py-1.5 rounded-lg bg-rose-600 text-white hover:bg-rose-700 text-sm shadow-soft transition"><i class="ti ti-logout-2"></i> Salir</button>
              </form>
            {% else %}
              <a href="{{ url_for('login') }}" class="px-3 py-1.5 rounded-lg bg-pink-600 text-white hover:bg-pink-500 text-sm shadow-soft transition">Iniciar sesi贸n</a>
              <a href="{{ url_for('register') }}" class="px-3 py-1.5 rounded-lg border border-pink-400 text-pink-600 hover:bg-pink-50 dark:hover:bg-slate-800 text-sm shadow-soft transition">Crear cuenta</a>
            {% endif %}
          </div>
        </div>
      </header>

      <!-- Flash messages -->
      <div class="max-w-7xl mx-auto px-4 mt-4">
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <div class="space-y-2">
              {% for category, message in messages %}
                <div class="rounded-xl px-4 py-3 text-sm shadow-soft
                        {% if category in ['success'] %} bg-emerald-100/80 text-emerald-900 dark:bg-emerald-900/50 dark:text-emerald-100
                        {% elif category in ['warning'] %} bg-amber-100/80 text-amber-900 dark:bg-amber-900/50 dark:text-amber-100
                        {% elif category in ['danger','error'] %} bg-rose-100/80 text-rose-900 dark:bg-rose-900/50 dark:text-rose-100
                        {% else %} bg-slate-100/80 text-slate-900 dark:bg-slate-800/70 dark:text-slate-100 {% endif %}">
                  {{ message }}
                </div>
              {% endfor %}
            </div>
          {% endif %}
        {% endwith %}
      </div>

      <!-- CONTENT -->
      <main class="max-w-7xl mx-auto w-full px-4 py-6">
        {% block content %}{% endblock %}
      </main>
    </div>
  </div>

  <script>
    document.getElementById('themeToggle')?.addEventListener('click', () => {
      const cl = document.documentElement.classList;
      const isDark = cl.toggle('dark');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
    });
  </script>
</body>
</html>
