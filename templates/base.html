<!DOCTYPE html>
<html lang="es" class="h-full">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ title or "Dinobrew · Panel de Control" }}</title>

  <!-- Iconos -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="https://unpkg.com/@tabler/icons-webfont@latest/tabler-icons.min.css">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: {
              50:"#F4E3C1",100:"#EFD3A0",200:"#E4B169",300:"#D69745",
              400:"#C17A33",500:"#A25F22",600:"#794617",700:"#4B2E05",
              800:"#3B2304",900:"#2C1A03"
            },
            gold: {
              50:"#FFF7DC",100:"#FBE9B9",200:"#F4D889",300:"#EEC766",
              400:"#E8C66A",500:"#DDB44C",600:"#C79E37",700:"#A78129",
              800:"#87661C",900:"#6B4F14"
            },
            ink: { 900:"#0B0B0B", 800:"#121212", 700:"#171717" }
          },
          boxShadow: {
            soft:"0 8px 24px rgba(0,0,0,.10)",
            gold:"0 0 0 1px rgba(232,198,106,.35), 0 8px 24px rgba(0,0,0,.25)"
          }
        }
      },
      darkMode: 'class'
    }
  </script>

  <style>
    .glass { background: rgba(255,255,255,.8); backdrop-filter: saturate(180%) blur(8px); }
    .dark .glass { background: rgba(11,11,11,.6); }
    :root { --header-h: 64px; }
    .sidebar-overlay {
      position: fixed; left: 0; top: var(--header-h);
      height: calc(100vh - var(--header-h));
      width: 0; z-index: 40; transition: width .35s ease;
    }
    .sidebar-sheet {
      position: absolute; inset: 0 auto 0 0; width: 16rem;
      transform: translateX(-100%); transition: transform .35s ease;
      border-right: 1px solid rgba(193,122,51,.35);
    }
    .sidebar-overlay:hover { width: 16rem; }
    .sidebar-overlay:hover .sidebar-sheet { transform: translateX(0); }
    .toggle-tab{
      position:absolute; top:10px; left:0; width:34px; height:42px;
      background: linear-gradient(135deg,#C17A33,#A25F22); color:#fff;
      display:flex; align-items:center; justify-content:center;
      border-top-right-radius:10px; border-bottom-right-radius:10px;
      box-shadow:2px 2px 10px rgba(0,0,0,.25); z-index:41; cursor:pointer;
      transition:background .25s ease;
    }
    .toggle-tab:hover{ background: linear-gradient(135deg,#E4B169,#C17A33); }
    .sidebar-overlay:hover .toggle-tab i{ transform: rotate(180deg); }
    .toggle-tab i{ transition: transform .25s ease; }
    .drawer {
      position:fixed; inset:0 auto 0 0; width:18rem; transform:translateX(-100%);
      transition: transform .35s ease; z-index:50;
    }
    .drawer.backdrop { inset:0; width:100%; transform:none; background:rgba(0,0,0,.4); display:none; }
    .drawer-open .drawer.panel { transform: translateX(0); }
    .drawer-open .drawer.backdrop { display:block; }
    @media (max-width: 767px) { .sidebar-overlay{ display:none; } }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <script>
    (function(){
      const s = localStorage.getItem('theme');
      if(s==='dark' || (!s && matchMedia('(prefers-color-scheme: dark)').matches))
        document.documentElement.classList.add('dark');
    })();
  </script>
</head>

<body class="h-full bg-gradient-to-br from-brand-50 via-brand-100 to-brand-200 dark:from-ink-900 dark:via-ink-800 dark:to-ink-900 text-brand-900 dark:text-gold-50">
  <div class="min-h-screen flex">
    <div class="flex-1 flex flex-col">

      <header id="appHeader" class="glass border-b border-white/60 dark:border-ink-700 sticky top-0 z-10">
        <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between gap-3">
          <div class="flex items-center gap-3">
            <a href="{{ url_for('index') }}" class="flex items-center gap-3">
              <div class="flex items-center justify-center h-12 w-12 rounded-full
                          bg-gradient-to-br from-brand-400 to-brand-600 dark:from-gold-700 dark:to-gold-500
                          shadow-md border border-white/30 dark:border-gold-700/40">
                <i class="fa-solid fa-beer-mug-empty text-white dark:text-ink-900 text-2xl"></i>
              </div>
              <span class="text-2xl font-extrabold tracking-wide ml-1
                           text-brand-700 dark:text-gold-400">Dinobrew</span>
            </a>
          </div>

          <div class="flex items-center gap-2">
            <button id="btnMenu" class="md:hidden inline-flex items-center justify-center w-10 h-10 rounded-lg
                                       bg-white/70 hover:bg-white dark:bg-ink-800 dark:hover:bg-ink-700
                                       border border-white/40 dark:border-ink-700" title="Menú">
              <i class="ti ti-menu-2 text-brand-700 dark:text-gold-400"></i>
            </button>

            <button id="themeToggle" class="inline-flex items-center justify-center w-10 h-10 rounded-lg
                                           hover:bg-white/70 dark:hover:bg-ink-700 border border-white/40 dark:border-ink-700"
                    title="Tema" aria-pressed="false">
              <i id="iconMoon" class="ti ti-moon-stars text-brand-700 dark:hidden"></i>
              <i id="iconSun"  class="ti ti-sun text-gold-400 hidden dark:inline"></i>
            </button>

            {% if current_user.is_authenticated %}
              <span class="hidden sm:inline text-sm text-brand-800 dark:text-gold-200">
                Hola, {{ current_user.name }}
              </span>
              <form action="{{ url_for('logout') }}" method="post">
                <button class="px-3 py-1.5 rounded-lg bg-brand-600 text-white hover:bg-brand-500
                               dark:bg-ink-800 dark:text-gold-300 dark:hover:bg-ink-700 border border-transparent
                               dark:border-gold-700/40 shadow-soft">
                  <i class="ti ti-logout-2"></i> Salir
                </button>
              </form>
            {% else %}
              <a href="{{ url_for('login') }}"
                 class="px-3 py-1.5 rounded-lg bg-brand-600 text-white hover:bg-brand-500 shadow-soft
                        dark:bg-gold-600 dark:text-ink-900 dark:hover:bg-gold-500">Iniciar sesión</a>
              <a href="{{ url_for('register') }}"
                 class="px-3 py-1.5 rounded-lg border border-brand-400 text-brand-700 hover:bg-brand-50
                        dark:border-gold-700 dark:text-gold-300 dark:hover:bg-ink-800">Crear cuenta</a>
            {% endif %}
          </div>
        </div>
      </header>

      <!-- FLASHES -->
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          <div class="max-w-3xl mx-auto px-4 mt-4 space-y-2 w-full">
            {% for category, message in messages %}
              <div class="rounded-lg px-4 py-3 text-sm
                          {% if category in ['error','danger'] %}
                            bg-red-50 text-red-800 border border-red-200
                          {% elif category in ['warning'] %}
                            bg-yellow-50 text-yellow-900 border border-yellow-200
                          {% else %}
                            bg-green-50 text-green-800 border border-green-200
                          {% endif %}">
                {{ message }}
              </div>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}

      <div class="sidebar-overlay hidden md:block" aria-hidden="true">
        <div class="toggle-tab" title="Abrir panel"><i class="fa-solid fa-chevron-right"></i></div>

        <aside class="sidebar-sheet flex flex-col
                       bg-gradient-to-b from-brand-100/80 via-brand-50/60 to-brand-200/60
                       dark:from-ink-800/80 dark:via-ink-800/70 dark:to-ink-900/70
                       backdrop-blur-xl shadow-lg">

          <div class="px-4 py-4 flex items-center gap-3">
            <i class="fa-solid fa-beer-mug-empty text-2xl text-brand-600 dark:text-gold-400"></i>
            <div>
              <div class="font-extrabold leading-tight text-brand-700 dark:text-gold-400 text-lg">Dinobrew</div>
              <div class="text-xs text-brand-700/70 dark:text-gold-300/70">Panel de Control</div>
            </div>
          </div>

          <nav class="mt-2 px-2 text-sm space-y-1">
            <a href="{{ url_for('index') }}" class="flex items-center gap-3 px-3 py-2 rounded-lg
               hover:bg-brand-100/60 dark:hover:bg-ink-800
               {% if request.endpoint=='index' %}bg-brand-100/60 dark:bg-ink-800{% endif %}">
              <i class="fa-solid fa-house text-brand-600 dark:text-gold-400 text-lg"></i>
              <span>Inicio</span>
            </a>

            <a href="{{ url_for('producto') }}" class="flex items-center gap-3 px-3 py-2 rounded-lg
               hover:bg-brand-100/60 dark:hover:bg-ink-800
               {% if request.endpoint=='producto' %}bg-brand-100/60 dark:bg-ink-800{% endif %}">
              <i class="fa-solid fa-bottle-droplet text-brand-600 dark:text-gold-400 text-lg"></i>
              <span>Nuestra Cerveza</span>
            </a>

            {% if current_user.is_authenticated %}
            <a href="{{ url_for('entendimiento') }}" class="flex items-center gap-3 px-3 py-2 rounded-lg
               hover:bg-brand-100/60 dark:hover:bg-ink-800
               {% if request.endpoint=='entendimiento' %}bg-brand-100/60 dark:bg-ink-800{% endif %}">
              <i class="fa-solid fa-chart-line text-brand-600 dark:text-gold-400 text-lg"></i>
              <span>DinoAnalyticsML</span>
            </a>
            {% endif %}

            <a href="{{ url_for('nosotros') }}" class="flex items-center gap-3 px-3 py-2 rounded-lg
               hover:bg-brand-100/60 dark:hover:bg-ink-800
               {% if request.endpoint=='nosotros' %}bg-brand-100/60 dark:bg-ink-800{% endif %}">
              <i class="fa-solid fa-users text-brand-600 dark:text-gold-400 text-lg"></i>
              <span>Quiénes Somos</span>
            </a>

            <a href="{{ url_for('contactenos', _anchor='form') }}" class="flex items-center gap-3 px-3 py-2 rounded-lg
               hover:bg-brand-100/60 dark:hover:bg-ink-800
               {% if request.endpoint=='contactenos' %}bg-brand-100/60 dark:bg-ink-800{% endif %}">
              <i class="fa-solid fa-envelope text-brand-600 dark:text-gold-400 text-lg"></i>
              <span>Contáctenos</span>
            </a>

            {% if current_user.is_authenticated and current_user.is_admin %}
            <a href="{{ url_for('admin_contactos') }}" class="flex items-center gap-3 px-3 py-2 rounded-lg
               hover:bg-brand-100/60 dark:hover:bg-ink-800
               {% if request.endpoint=='admin_contactos' %}bg-brand-100/60 dark:bg-ink-800{% endif %}">
              <i class="fa-solid fa-inbox text-brand-600 dark:text-gold-400 text-lg"></i>
              <span>Contactos (Admin)</span>
            </a>
            {% endif %}
          </nav>

          <div class="mt-auto p-4 text-xs text-brand-700/70 dark:text-gold-300/70">
            &copy; {{ 2025 }} Dinobrew · Sin excusas
          </div>
        </aside>
      </div>

      <div id="drawerBackdrop" class="drawer backdrop md:hidden"></div>
      <aside id="drawerPanel" class="drawer panel md:hidden
                    bg-white dark:bg-ink-900 border-r border-brand-100/60 dark:border-ink-700">

        <div class="px-4 py-4 flex items-center justify-between border-b border-brand-100/60 dark:border-ink-700">
          <div class="flex items-center gap-2">
            <i class="fa-solid fa-beer-mug-empty text-brand-600 dark:text-gold-400"></i>
            <span class="font-bold text-brand-700 dark:text-gold-300">Dinobrew</span>
          </div>
          <button id="btnCloseDrawer" class="w-9 h-9 rounded-lg hover:bg-brand-50 dark:hover:bg-ink-800">
            <i class="ti ti-x text-brand-700 dark:text-gold-300"></i>
          </button>
        </div>

        <nav class="p-3 space-y-1 text-sm">
          <a href="{{ url_for('index') }}" class="block px-3 py-2 rounded-lg hover:bg-brand-50 dark:hover:bg-ink-800">
            <i class="fa-solid fa-house mr-2 text-brand-600 dark:text-gold-400"></i>
            Inicio
          </a>

          <a href="{{ url_for('producto') }}" class="block px-3 py-2 rounded-lg hover:bg-brand-50 dark:hover:bg-ink-800">
            <i class="fa-solid fa-bottle-droplet mr-2 text-brand-600 dark:text-gold-400"></i>
            Producto
          </a>

          {% if current_user.is_authenticated %}
          <a href="{{ url_for('entendimiento') }}" class="block px-3 py-2 rounded-lg hover:bg-brand-50 dark:hover:bg-ink-800">
            <i class="fa-solid fa-boxes-stacked mr-2 text-brand-600 dark:text-gold-400"></i>
            DinoAnalyticsML
          </a>
          {% endif %}

          <a href="{{ url_for('nosotros') }}" class="block px-3 py-2 rounded-lg hover:bg-brand-50 dark:hover:bg-ink-800">
            <i class="fa-solid fa-users mr-2 text-brand-600 dark:text-gold-400"></i>
            Quiénes Somos
          </a>

          <a href="{{ url_for('contactenos', _anchor='form') }}" class="block px-3 py-2 rounded-lg hover:bg-brand-50 dark:hover:bg-ink-800">
            <i class="fa-solid fa-envelope mr-2 text-brand-600 dark:text-gold-400"></i>
            Contáctenos
          </a>

          {% if current_user.is_authenticated and current_user.is_admin %}
          <a href="{{ url_for('admin_contactos') }}" class="block px-3 py-2 rounded-lg hover:bg-brand-50 dark:hover:bg-ink-800">
            <i class="fa-solid fa-inbox mr-2 text-brand-600 dark:text-gold-400"></i>
            Contactos (Admin)
          </a>
          {% endif %}
        </nav>
      </aside>

      <main class="max-w-7xl mx-auto w-full px-4 py-6">
        {% block content %}{% endblock %}
      </main>
    </div>
  </div>

  <script>
    document.getElementById('themeToggle')?.addEventListener('click', () => {
      const cl = document.documentElement.classList;
      const isDark = cl.toggle('dark');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
    });

    function setHeaderHeightVar() {
      const h = document.getElementById('appHeader')?.offsetHeight || 64;
      document.documentElement.style.setProperty('--header-h', h + 'px');
    }
    window.addEventListener('load', setHeaderHeightVar);
    window.addEventListener('resize', setHeaderHeightVar);

    const html = document.documentElement;
    const btnMenu = document.getElementById('btnMenu');
    const btnClose = document.getElementById('btnCloseDrawer');
    const backdrop = document.getElementById('drawerBackdrop');

    function openDrawer(){ html.classList.add('drawer-open'); }
    function closeDrawer(){ html.classList.remove('drawer-open'); }

    btnMenu?.addEventListener('click', openDrawer);
    btnClose?.addEventListener('click', closeDrawer);
    backdrop?.addEventListener('click', closeDrawer);
    window.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeDrawer(); });
  </script>
</body>
</html>
